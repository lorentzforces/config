#!/usr/bin/env bash
set -u

# invoke the local platform's "open with app" command

TARGET=${1:-}

main() {
	local xdg_present open_present is_macos=""
	xdg_present=$(present_check "xdg-open")
	open_present=$(present_check "open")
	if [[ $(uname -s) == "Darwin" ]]; then
		is_macos="yup it's MacOS"
	fi

	# always prefer the xdg option if it exists
	if [[ -n "$xdg_present" ]]; then
		xdg-open "$TARGET"
	elif [[ -n "$open_present" && -n "$is_macos" ]]; then
		open "$TARGET"
	else
		_ltz_print_error "invoked custom open command but could not determine which open command to delegate to"
		exit 1
	fi
}

# accepts one argument of an executable name, then checks for it on the PATH
# prints "present" if present, nothing otherwise
present_check() {
	local exec_name=${1:-}
	if [[ -z "$exec_name" ]]; then
		_ltz_print_error "Empty exec name for present_check"
		return 1
	fi

	if &>/dev/null type "$exec_name"; then
		echo -n "present"
	fi
}

main
