#!/usr/bin/env bash
set -u

# invoke the local platform's "open with app" command

TARGET=${1:-}

main() {
	local xdg_present="" open_present="" is_macos=""
	if &>/dev/null type xdg-open; then
		xdg_present="present"
	fi
	if &>/dev/null type open; then
		open_present="present"
	fi
	if [[ $(uname -s) == "Darwin" ]]; then
		is_macos="yup it's MacOS"
	fi

	# always prefer the xdg option if it exists
	if [[ -n "$xdg_present" ]]; then
		xdg-open "$TARGET"
	elif [[ -n "$open_present" && -n "$is_macos" ]]; then
		open "$TARGET"
	else
		read -r -d '' ERROR_MSG <<-EOF
		Invoked custom open command but could not determine which open command to
		delegate to.
		EOF
		_ltz_print_error "$ERROR_MSG"
		exit 1
	fi
}
main
